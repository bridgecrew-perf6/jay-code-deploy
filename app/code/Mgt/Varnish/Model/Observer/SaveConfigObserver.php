<?php
 namespace Mgt\Varnish\Model\Observer; use Magento\Framework\Event\ObserverInterface; use Magento\Framework\Event\Observer; class SaveConfigObserver implements ObserverInterface { const FULL_PAGE_CACHE_STATUS_ENABLED = 1; const FULL_PAGE_CACHE_STATUS_DISABLED = 0; protected $config; protected $deploymentConfigWriter; protected $configValueFactory; protected $cachePurger; protected $cacheTypeList; public function __construct(\Mgt\Varnish\Model\Cache\Config $config, \Magento\Framework\App\DeploymentConfig\Writer $deploymentConfigWriter, \Magento\Framework\App\Config\ValueFactory $configValueFactory, \Magento\CacheInvalidate\Model\PurgeCache $cachePurger, \Magento\Framework\App\Cache\TypeListInterface $cacheTypeList) { goto A8d3f; A8d3f: $this->config = $config; goto Fcc02; Db7e1: $this->cachePurger = $cachePurger; goto ed1ec; Fcc02: $this->deploymentConfigWriter = $deploymentConfigWriter; goto A71ee; A71ee: $this->configValueFactory = $configValueFactory; goto Db7e1; ed1ec: $this->cacheTypeList = $cacheTypeList; goto Ddc22; Ddc22: } public function execute(Observer $observer) { $isVarnishEnabled = $this->config->isEnabled(); try { goto B2d72; E9d40: $cacheTypes["\x66\x75\154\154\137\160\141\147\x65"]->setStatus(self::FULL_PAGE_CACHE_STATUS_DISABLED); goto ab8df; D911d: goto c93c7; goto cfb85; f99f8: c00c5: goto ea9ef; B2d72: $configValue = $this->configValueFactory->create(); goto D013f; D013f: $configValue->load(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE, "\x70\x61\164\x68"); goto Ed043; Ed043: $cacheTypes = $this->cacheTypeList->getTypes(); goto d1578; d1578: if (true === $isVarnishEnabled) { goto Da011; } goto c0db1; ad336: $cacheTypes["\146\x75\154\x6c\x5f\160\141\147\x65"]->setStatus(self::FULL_PAGE_CACHE_STATUS_ENABLED); goto Eaf0f; ea9ef: if (!isset($cacheTypes["\x66\165\x6c\154\x5f\160\x61\x67\x65"])) { goto d4b0d; } goto E9d40; c0db1: if (!$configValue->getId()) { goto c00c5; } goto E4d2d; B9ffd: $this->deploymentConfigWriter->saveConfig($appEnvDataCacheTypes, true); goto D0314; E3c80: ccaa3: goto B9ffd; ac1a1: cc069: goto E3c80; cfb85: Da011: goto D606f; Fd4ce: $appEnvDataCacheTypes = []; goto c27c3; Eaf0f: Da6c5: goto C90e4; C90e4: c93c7: goto Fd4ce; E4d2d: $configValue->delete(); goto f99f8; C085c: $configValue->save(); goto B0643; B0643: if (!isset($cacheTypes["\146\x75\154\154\137\160\141\x67\x65"])) { goto Da6c5; } goto ad336; ab8df: d4b0d: goto a01b7; cae10: $configValue->setValue(\Magento\PageCache\Model\Config::VARNISH); goto C085c; acfd1: foreach ($cacheTypes as $cacheTypeKey => $cacheType) { $appEnvDataCacheTypes["\x61\160\x70\x5f\x65\156\x76"]["\143\141\x63\x68\145\x5f\x74\171\160\145\163"][$cacheTypeKey] = (int) $cacheType->getStatus(); d1e55: } goto ac1a1; D606f: $configValue->setPath(\Magento\PageCache\Model\Config::XML_PAGECACHE_TYPE); goto cae10; a01b7: $this->cachePurger->sendPurgeRequest("\x2a"); goto D911d; c27c3: if (!$cacheTypes) { goto ccaa3; } goto acfd1; D0314: } catch (\Exception $e) { throw new $e(); } } }
