<?php
 namespace Mgt\Varnish\Model; use Zend\Uri\Uri; class UrlQueue extends \Magento\Framework\Model\AbstractModel { const PRIORITY_HIGH = 1000; const PRIORITY_MEDIUM = 500; const PRIORITY_LOW = 100; protected $storeManager; protected $license; protected $licenseCache = []; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Mgt\Varnish\Model\ResourceModel\UrlQueue $resource, \Magento\Store\Model\StoreManagerInterface $storeManager, \Mgt\Varnish\Model\License $license) { goto e36d8; c9ba2: $this->license = $license; goto dd831; b8814: $this->storeManager = $storeManager; goto c9ba2; e36d8: parent::__construct($context, $registry, $resource); goto b8814; dd831: } protected function _construct() { $this->_init("\115\x67\164\x5c\x56\141\162\x6e\151\x73\x68\134\x4d\157\x64\x65\154\134\x52\x65\x73\157\165\x72\x63\145\x4d\157\x64\145\154\x5c\125\162\154\x51\165\x65\x75\x65"); } public function getId() { return parent::getData("\165\162\154\137\151\144"); } public function addToQueue(array $urls) { goto E7822; e3c5c: E2691: goto fd80e; d16ce: $resource = $this->_getResource(); goto ca03b; ca03b: $resource->addToQueue($urls); goto e3c5c; E7822: $urls = $this->filterUrls($urls); goto Ac6dd; Ac6dd: if (!$urls) { goto E2691; } goto d16ce; fd80e: } protected function filterUrls(array $urls) { goto d8523; E3517: Ba8a4: goto A208a; A208a: return $filteredUrls; goto d4fa1; d8523: $filteredUrls = []; goto B5507; B5507: foreach ($urls as $url) { goto D22bd; D22bd: $storeId = (int) $url["\163\164\157\x72\x65\137\x69\x64"]; goto E1884; e8f72: $filteredUrls[] = $url; goto E4c58; Bfd21: if (!(true === $canAddUrlToQueue)) { goto Cd09f; } goto e8f72; b8afd: $canAddUrlToQueue = $this->canAddUrlToQueue($storeId); goto Bfd21; E4c58: Cd09f: goto e55d6; e55d6: e5ea9: goto E4f69; E1884: $url["\x70\141\x74\x68"] = ltrim($url["\160\141\164\150"], "\57"); goto b8afd; E4f69: } goto E3517; d4fa1: } protected function canAddUrlToQueue($storeId) { goto Ee989; Afba4: $hasLicense = $this->license->hasLicense($host); goto B9b29; e1968: return true; goto dbd21; Ee989: if (isset($this->licenseCache[$storeId])) { goto D4746; } goto d226a; c7164: $uri = new Uri($store->getBaseUrl()); goto ef03d; dbd21: F61cd: goto a60cd; ef03d: $host = $uri->getHost(); goto Afba4; c88d2: goto F61cd; goto F13dc; Bfdf9: B2b16: goto B341c; d226a: $store = $this->storeManager->getStore($storeId); goto c7164; ae636: $canAddUrlToQueue = $this->licenseCache[$storeId]; goto a5658; F13dc: f89d0: goto e1968; B9b29: $this->licenseCache[$storeId] = $hasLicense; goto D3279; D0680: D4746: goto ae636; a4c78: return false; goto c88d2; D3279: if (true === $hasLicense) { goto f89d0; } goto a4c78; a5658: return $canAddUrlToQueue; goto Bfdf9; a60cd: goto B2b16; goto D0680; B341c: } }
