<?php
 namespace Mgt\Varnish\Model\Feed; use Magento\Framework\Config\ConfigOptionsListConstants; class Feed extends \Magento\Framework\Model\AbstractModel { const FEED_URL = "\150\164\164\160\x3a\x2f\x2f\x66\x65\145\x64\x2e\155\x67\x74\x2d\x63\157\x6d\155\x65\162\x63\145\x2e\x63\x6f\155\x2f"; const UPDATE_FREQUENCY = 21600; const SEVERITY_INFORMATION = 4; protected $backendConfig; protected $inboxFactory; protected $storeManager; protected $deploymentConfig; protected $productMetadata; protected $urlBuilder; public function __construct(\Magento\Framework\Model\Context $context, \Magento\Framework\Registry $registry, \Magento\Backend\App\ConfigInterface $backendConfig, \Magento\AdminNotification\Model\InboxFactory $inboxFactory, \Magento\Store\Model\StoreManagerInterface $storeManager, \Magento\Framework\App\DeploymentConfig $deploymentConfig, \Magento\Framework\App\ProductMetadataInterface $productMetadata, \Magento\Framework\UrlInterface $urlBuilder, \Magento\Framework\Model\ResourceModel\AbstractResource $resource = null, \Magento\Framework\Data\Collection\AbstractDb $resourceCollection = null, array $data = []) { goto ade7f; b2e29: $this->storeManager = $storeManager; goto efa30; f54cb: $this->urlBuilder = $urlBuilder; goto E6c79; ade7f: parent::__construct($context, $registry, $resource, $resourceCollection, $data); goto A57fe; A57fe: $this->backendConfig = $backendConfig; goto Ce5d1; Ce5d1: $this->inboxFactory = $inboxFactory; goto b2e29; F7b22: $this->productMetadata = $productMetadata; goto f54cb; efa30: $this->deploymentConfig = $deploymentConfig; goto F7b22; E6c79: } protected function _construct() { } public function checkUpdate() { goto b4570; E2898: $installDate = strtotime($this->deploymentConfig->get(ConfigOptionsListConstants::CONFIG_PATH_INSTALL_DATE)); goto c9bdd; Debe7: $this->inboxFactory->create()->parse(array_reverse($feedData)); goto Ce166; b4570: $frequency = $this->getFrequency(); goto dd8e4; F2e08: $this->setLastUpdate(); goto f0e37; f00df: foreach ($feedXml->channel->item as $item) { goto fe5d5; fd134: if (!($installDate <= $itemPublicationDate)) { goto B90b9; } goto eb15b; fe5d5: $itemPublicationDate = strtotime((string) $item->pubDate); goto fd134; E0ee0: b1ea7: goto F1bbb; Ac731: B90b9: goto E0ee0; eb15b: $feedData[] = ["\x73\145\x76\145\162\151\164\x79" => self::SEVERITY_INFORMATION, "\x64\x61\164\x65\137\x61\x64\144\x65\x64" => date("\131\55\155\55\x64\40\x48\72\x69\72\163", $itemPublicationDate), "\x74\151\164\154\145" => (string) $item->title, "\x64\x65\163\x63\162\x69\x70\x74\151\157\156" => (string) $item->description, "\x75\x72\154" => (string) $item->link]; goto Ac731; F1bbb: } goto e917e; dd8e4: $lastUpdate = $this->getLastUpdate(); goto da23f; c1e51: C92c9: goto a98c0; f0e37: return $this; goto f0440; e917e: Cc5db: goto bd9eb; a98c0: $feedData = []; goto E0cd9; c9bdd: if (!($feedXml && isset($feedXml->channel) && isset($feedXml->channel->item))) { goto cb969; } goto f00df; c0a2d: cb969: goto F2e08; Ce166: C05c9: goto c0a2d; bd9eb: if (!$feedData) { goto C05c9; } goto Debe7; E0cd9: $feedXml = $this->getFeedData(); goto E2898; c0d2c: return $this; goto c1e51; da23f: if (!($frequency + $lastUpdate > time())) { goto C92c9; } goto c0d2c; f0440: } public function getFrequency() { return self::UPDATE_FREQUENCY; } public function getLastUpdate() { return $this->_cacheManager->load("\155\x67\x74\137\146\145\x65\x64\137\x61\x64\155\x69\x6e\x5f\156\x6f\x74\x69\x66\151\143\x61\164\x69\x6f\156\163\x5f\154\141\x73\x74\143\150\x65\x63\153"); } public function setLastUpdate() { $this->_cacheManager->save(time(), "\x6d\x67\164\x5f\146\x65\x65\144\137\x61\x64\155\x69\156\137\x6e\x6f\x74\x69\x66\151\x63\141\x74\151\x6f\x6e\163\x5f\154\141\163\x74\143\x68\145\143\x6b"); return $this; } public function getFeedData() { try { goto da37a; Bb1fb: $data = $client->request(\Zend_Http_Client::POST); goto Bc418; A9cc3: Db0a6: goto c9441; A89e3: $client->setParameterPost($postParams); goto E6015; A1e12: $postParams = ["\163\x68\x6f\x70\137\165\162\154" => $this->storeManager->getStore()->getBaseUrl(), "\x76\145\162\x73\151\x6f\x6e" => $this->productMetadata->getVersion()]; goto Fb517; Bc418: if (!($data = $data->getBody())) { goto Db0a6; } goto Abc6a; Abc6a: $xml = new \SimpleXMLElement($data); goto A9cc3; E6015: $client->setConfig(array("\x6d\x61\170\162\x65\x64\x69\162\x65\143\164\163" => 0, "\x74\x69\x6d\x65\157\x75\x74" => 30)); goto Bb1fb; da37a: $xml = ''; goto A1e12; Fb517: $client = new \Zend_Http_Client(self::FEED_URL); goto A89e3; c9441: } catch (\Exception $e) { return false; } return $xml; } }
